@using Signum.Entities.DynamicQuery
@using Signum.Entities.Reflection
@using Signum.Engine.DynamicQuery
@model Context
@{ 
    List<FilterOption> filterOptions = (List<FilterOption>)ViewData[ViewDataKeys.FilterOptions];
    QueryDescription queryDescription = (QueryDescription)ViewData[ViewDataKeys.QueryDescription];
    bool filtersVisible = (bool?)ViewData[ViewDataKeys.FiltersVisible] ?? true;
    bool showAddColumn = (bool?)ViewData[ViewDataKeys.ShowAddColumn] ?? false;
}


<div id="@Model.Compose("tblFilterBuilder")" class="panel panel-default sf-filters" @(filtersVisible ? "" : "style=display:none")>
    <div class="panel-heading sf-filters-body">
        @Html.QueryTokenBuilder(null, Model, SearchControlHelper.GetQueryTokenBuilderSettings(queryDescription))

        <a id="@Model.Compose("btnAddFilter")" class="sf-query-button sf-add-filter btn btn-default btn-sm" title="@SearchMessage.AddFilter.NiceToString()">
          <span class="glyphicon glyphicon-arrow-down"></span>@SearchMessage.AddFilter.NiceToString()
        </a>
       
        @if (showAddColumn)
        {
             <a id="@Model.Compose("btnAddColumn")" class="sf-query-button sf-add-column btn btn-default btn-sm" title="@SearchMessage.AddColumn.NiceToString()">
                <span class="glyphicon glyphicon-arrow-right"></span>@SearchMessage.AddColumn.NiceToString()
            </a>
        }
    </div>

    <div class="panel-body sf-filters-list">
        <div class="sf-explanation" style="@((filterOptions == null || filterOptions.Count == 0) ? "" : "display:none;")">@SearchMessage.NoFiltersSpecified.NiceToString()</div>
        <table id="@Model.Compose("tblFilters")" style="@((filterOptions == null || filterOptions.Count == 0) ? "display:none" : null)" class="table">
            <thead>
                <tr>
                    <th></th>
                    <th class="sf-filter-field-header">@SearchMessage.Field.NiceToString()
                    </th>
                    <th>@SearchMessage.Operation.NiceToString()
                    </th>
                    <th>@SearchMessage.Value.NiceToString()
                    </th>
                </tr>
            </thead>
            <tbody>
                @for (int i = 0; i < filterOptions.Count; i++)
                {
                    FilterOption filter = filterOptions[i];
                    @Html.NewFilter(queryDescription.QueryName, filter, Model, i)
                }
            </tbody>
        </table>
    </div>
</div>
